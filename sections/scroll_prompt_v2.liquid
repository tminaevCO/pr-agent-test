{% liquid
  assign click_to_scroll = section.settings.click_to_scroll
  assign scroll_to = section.settings.scroll_to
  assign css_query = section.settings.css_query
  assign background_color = section.settings.background_color
  assign fullwidth_background = section.settings.fullwidth_background
  assign border_radius = settings.border_radius

  assign top_padding = section.settings.top_padding
  assign bottom_padding = section.settings.bottom_padding
  assign side_padding = section.settings.side_padding
  assign top_margin = section.settings.top_margin
  assign bottom_margin = section.settings.bottom_margin

  assign scroll_aim = ''
  assign fullwidth_background = section.settings.fullwidth_background

  case scroll_to
    when 'top'
      assign scroll_aim = 'header'
    when 'bottom'
      assign scroll_aim = '.footer--inner'
    when 'element'
      assign scroll_aim = css_query
  endcase
%}

{% stylesheet %}
  html,
  body {
    scroll-behavior: smooth;
  }

  .scroll-prompt--inner {
    width: 100%;
  }

  .scroll-prompt__content {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
  }

  .scroll-prompt__content .block__title {
    width: 100%;
  }

  .scroll-prompt__content .scroll-prompt__scroll-to-top {
    cursor: pointer;
    flex-direction: column;
  }

  .scroll-prompt__content .scroll-prompt__scroll-to-top .block__paragraph {
    font-weight: 500;
  }
{% endstylesheet %}

{% style %}
  #shopify-section-{{ section.id }} {
    position: relative;
    overflow: hidden;
    border-radius: 0;
    margin-top: {{ top_margin | divided_by: 2 }}px;
    margin-bottom: {{ bottom_margin | divided_by: 2 }}px;
  }

  {% if background_color.alpha != null and background_color.alpha != 0.0 %}
    {% if fullwidth_background %}
      #shopify-section-{{ section.id }} {
        background-color: {{background_color}};
        max-width: 100%;
        padding-top: {{top_padding}}px;
        padding-bottom: {{bottom_padding}}px;
        padding-left: 0;
        padding-right: 0;
      }

      #shopify-section-{{ section.id }} .scroll-prompt--inner {
        max-width: {{ settings.page_width }}px;
        margin: 0 auto;
        padding-left: 16px;
        padding-right: 16px;
      }
    {% else %}
      #shopify-section-{{ section.id }}{
        background-color: {{background_color}};
        padding-top: {{top_padding}}px;
        padding-bottom: {{bottom_padding}}px;
        padding-left: {{side_padding}}px;
        padding-right: {{side_padding}}px;
        box-sizing: border-box;
      }
    {% endif %}
  {% endif %}

  #shopify-section-{{section.id}} .svg-placeholder {
    background-color: {% if background_color.alpha and background_color.alpha != 0.0 %}{{background_color}}{% else %}{{settings.image_background_color}}{% endif %};
    stroke: {{settings.icon_color}};
    fill: {{settings.icon_color}};
  }

  #shopify-section-{{ section.id }}{
    position: relative;
    display: flex;
  }

  @media only screen and (min-width: 769px) {
    #shopify-section-{{ section.id }} {
      margin-top: {{ top_margin }}px;
      margin-bottom: {{ bottom_margin }}px;
      border-radius: {{ border_radius }}px;
    }
  }
{% endstyle %}

<div class="scroll-prompt--inner">
  <div class="scroll-prompt__content">
    {% liquid
      assign icon = section.settings.icon
      assign icon_color = section.settings.icon_color
      assign custom_icon = section.settings.custom_icon
      assign width = section.settings.width
      assign paragraph = section.settings.paragraph
      assign font_size_scale = section.settings.font_size_scale
      assign paragraph_color = section.settings.paragraph_color
      assign max_width = section.settings.max_width
      assign top_margin = section.settings.top_margin
      assign bottom_margin = section.settings.bottom_margin
      if icon_color == blank or icon_color.alpha == 0.0
        assign icon_color = settings.icon_color
      endif
    %}

    {% style %}
      .scroll-prompt__block--{{ section.id }}{
        margin-top: {{ top_margin | divided_by: 2 }}px;
        margin-bottom: {{ bottom_margin | divided_by: 2 }}px;
        display: flex;
      }

      .scroll-prompt__block--{{ section.id }} .scroll-to-top__icon{
        width: {{ width }}px;
        margin: 0 auto;
      }

      .scroll-prompt__block--{{ section.id }} .scroll-to-top__icon *{
        width: 100%;
        height: auto;
      }

      @media only screen and (min-width: 769px) {
        .scroll-prompt__block--{{ section.id }}{
          margin-top: {{ top_margin }}px;
          margin-bottom: {{ bottom_margin }}px;
          display: flex;
      }
      }
    {% endstyle %}

    <div
      {% if click_to_scroll %}
        scroll-block href="{{ scroll_aim }}" data-section-id="{{ section.id }}"
      {% endif %}
      class="scroll-prompt__scroll-to-top scroll-prompt__block--{{ section.id }}"
    >
      <div class="scroll-to-top__icon">
        {%- if custom_icon != blank -%}
          {% render 'responsive-image-dynamic_v2', image: custom_icon, width: width, crop: 'center' %}
        {%- else -%}
          {% render 'icon_v2', icon: icon, color: icon_color %}
        {%- endif -%}
      </div>
      {% render 'paragraph_v2',
        text: paragraph,
        color: paragraph_color,
        default_color: settings.paragraph_color,
        font_size_scale: font_size_scale,
        block_id: section.id,
        max_width: max_width,
        visible_on_desktop: true,
        visible_on_mobile: true
      %}
    </div>
  </div>
</div>

{% javascript %}
  document.addEventListener('DOMContentLoaded', clickHandler());
  document.addEventListener('shopify:section:load', (event) => clickHandler(event));

  function clickHandler() {
    let scrollBlocks = document.querySelectorAll('.scroll-prompt__scroll-to-top[scroll-block]');
    scrollBlocks.forEach((block) => {
      let aimQuery = block.getAttribute('href');
      let sectionId = block.getAttribute('data-section-id');
      block.addEventListener('click', (e) => {
        const aimElement = document.querySelector(aimQuery);
        if (aimElement) {
          aimElement.scrollIntoView();
        }
      });
    });
  }
{% endjavascript %}

{% schema %}
{
  "name": "Scroll prompt",
  "tag": "section",
  "class": "scroll-prompt container",
  "settings": [
    {
      "type": "paragraph",
      "content": "Add this section to prompt the user to scroll to the top, bottom, or any custom point on this page. [See Tutorial](https:\/\/help.shopify.com\/manual\/customers\/manage-customers)"
    },
        {
      "type": "header",
      "content": "Scroll",
      "info": "Customize the layout and alignment of your section."
    },
      {
      "type": "checkbox",
      "id": "click_to_scroll",
      "label": "Click to scroll",
      "default": true
    },
    {
      "type": "select",
      "id": "scroll_to",
      "label": "Scroll to",
      "options": [
        {
          "value": "top",
          "label": "Top"
        },
        {
          "value": "bottom",
          "label": "Bottom"
        },
        {
          "value": "element",
          "label": "Element"
        }
      ],
      "default": "top"
    },
    {
      "type": "text",
      "id": "css_query",
      "label": "CSS query"
    },
           {
          "type": "header",
          "content": "Icon",
          "info": "Select your scroll icon or add something custom."
        },
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "options": [
            {
              "value": "arrow_up",
              "label": "Arrow up"
            },
            {
              "value": "arrow_down",
              "label": "Arrow down"
            },
            {
              "value": "mouse",
              "label": "Mouse"
            }
          ],
          "default": "mouse"
        },
        {
          "type": "color",
          "id": "icon_color",
          "label": "Icon color"
        },
        {
          "type": "image_picker",
          "id": "custom_icon",
          "label": "Custom icon"
        },
        {
          "type": "range",
          "id": "width",
          "min": 1,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "Width",
          "default": 56
        },
        {
          "type": "header",
          "content": "Label",
          "info": "Provide a label to accompany your icon."
        },
        {
          "type": "richtext",
          "id": "paragraph",
          "label": "Text"
        },
        {
          "type": "range",
          "id": "font_size_scale",
          "min": 75,
          "max": 125,
          "step": 1,
          "unit": "%",
          "label": "Font size scale",
          "default": 100
        },
        {
          "type": "color",
          "id": "paragraph_color",
          "label": "Color"
        },
        {
          "type": "range",
          "id": "max_width",
          "min": 300,
          "max": 1500,
          "step": 12,
          "unit": "px",
          "label": "Max width",
          "default": 1500
        },
    {
      "type": "header",
      "content": "Background",
      "info": "Personalize the background of your section to match your brand. "
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color"
    },
    {
      "type": "checkbox",
      "id": "fullwidth_background",
      "label": "Fullwidth background",
      "default": false
    },
    {
      "type": "header",
      "content": "Section padding",
      "info": "Add spacing above and below inside your new section."
    },
    {
      "type": "range",
      "id": "top_padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Top padding",
      "default": 15
    },
    {
      "type": "range",
      "id": "bottom_padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Bottom padding",
      "default": 15
    },
    {
      "type": "range",
      "id": "side_padding",
      "min": 10,
      "max": 60,
      "step": 1,
      "unit": "px",
      "label": "Side padding",
      "default": 24
    },
    {
      "type": "header",
      "content": "Section margin",
      "info": "Add spacing above and below your block."
    },
    {
      "type": "range",
      "id": "top_margin",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Top margin",
      "default": 0
    },
    {
      "type": "range",
      "id": "bottom_margin",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Bottom margin",
      "default": 0
    }
  ],

  "presets": [
    {
      "name": "Scroll prompt",
      "settings": {
        "click_to_scroll": true,
        "scroll_to": "top",
        "css_query": "",
        "icon": "arrow_up",
        "icon_color": "",
        "width": 18,
        "paragraph": "<p>Scroll to top<\/p>",
        "font_size_scale": 100,
        "paragraph_color": "",
        "max_width": 1500,
        "background_color": "rgba(0,0,0,0)",
        "fullwidth_background": false,
        "top_padding": 15,
        "bottom_padding": 15,
        "side_padding": 24,
        "top_margin": 40,
        "bottom_margin": 40
      }
    }
  ]
}
{% endschema %}
